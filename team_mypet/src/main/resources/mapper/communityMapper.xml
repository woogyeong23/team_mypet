<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace = "com.jeonju.mypet.community">

    <select id="getCommuList" resultType="communityVo">
    select * from community where cm_delyn = 'N'
    </select>
    
    
    <!-- CBView -->
    <select id="getCcmList" resultType="commu_commentVo">
    select * from commu_comment where cm_idx = #{cm_idx}
    </select>
    
    <select id="getReplyCount" resultType="int">
    SELECT DISTINCT COUNT(cc_idx) FROM commu_comment WHERE cm_idx=#{cm_idx}
    </select>
    
    <insert id="InsertCB" parameterType="communityVo">
    INSERT INTO community(midx, cm_subject, cm_content, cm_writer, cm_img, cm_origin_img)
    <choose>
      <when test="cm_img != null">
      VALUES(#{midx}, #{cm_subject}, #{cm_content}, #{cm_writer}, #{cm_img}, #{cm_origin_img})
      </when>
      <otherwise>
      VALUES(#{midx}, #{cm_subject}, #{cm_content}, #{cm_writer})
      </otherwise>
    </choose>
    </insert>
    
    <select id="getCBView" parameterType="int" resultType="communityVo">
    SELECT cm_subject, cm_content, cm_wday, cm_img, cm_writer,cm_idx, midx from community WHERE cm_idx= #{cm_idx}
    </select>
   
    <insert id="InsertComment" parameterType="commu_commentVo">
    <selectKey keyProperty="cc_origin" resultType="int" order="BEFORE">
     SELECT max(cc_idx)+1 FROM commu_comment
    </selectKey>
    INSERT INTO commu_comment(cc_origin, cc_content, cm_idx, cc_writer)
    VALUES(#{cc_origin}, #{cc_content}, #{cm_idx}, #{cc_writer})
    </insert>
    
    <update id="UpDepth" parameterType="commu_commentVo">
    UPDATE commu_comment SET cc_depth = cc_depth +1 WHERE cc_origin = #{cc_origin}
    AND cc_depth>#{cc_depth}
    </update>
    <insert id="CCInsert" parameterType="commu_commentVo">
    INSERT INTO commu_comment(cm_idx, cc_content, cc_writer, cc_origin, cc_depth, cc_level)
    VALUES( #{cm_idx}, #{cc_content}, #{cc_writer}, #{cc_origin}, #{cc_depth}, #{cc_level})
    </insert>
    
    <!--SellerStory  -->
    <select id="getBSList" resultType="sellerStoryVo">
    SELECT m_nick, seller_idx, seller_img, seller_intro, seller_starsavg, seller_followcnt
     FROM sellerstory INNER JOIN members ON members.midx = sellerstory.midx
    
    </select>
    
    <select id="getBSellerView" resultType="sellerStoryVo">
    SELECT seller_idx, seller_img, seller_intro, seller_openday, 
    seller_starsavg, seller_total, seller_wishcnt, seller_ordercnt, seller_followcnt 
    FROM sellerstory where seller_idx = #{seller_idx}
    </select>
    
     <select id="modi_CB" parameterType="int" resultType="communityVo">
    SELECT cm_subject, cm_content, cm_img, cm_idx, cm_writer,cm_origin_img FROM community WHERE cm_idx= #{cm_idx}
    </select>
    
    


</mapper>